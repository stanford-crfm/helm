'use client';
import{__rest as e}from"tslib";import r,{useState as t,useMemo as a}from"react";import o from"../../../assets/CalendarIcon.js";import d from"../../../assets/XCircleIcon.js";import{Popover as l,Listbox as n}from"@headlessui/react";import{startOfToday as m,startOfMonth as s}from"date-fns";import{border as i}from"../../../lib/shape.js";import{sizing as u}from"../../../lib/sizing.js";import{spacing as c}from"../../../lib/spacing.js";import{tremorTwMerge as f}from"../../../lib/tremorTwMerge.js";import{getNodeText as b,constructValueToNameMapping as g,getSelectButtonColors as p,hasValue as k}from"../selectUtils.js";import{defaultOptions as h,parseStartDate as v,parseEndDate as w,formatSelectedDates as x,makeDateRangePickerClassName as N}from"./dateRangePickerUtils.js";import E from"../Calendar/Calendar.js";import"../Select/Select.js";import j from"../Select/SelectItem.js";import{enUS as y}from"date-fns/locale";import S from"../../../hooks/useInternalState.js";const C=m(),X=r.forwardRef(((m,X)=>{var R,D;const{value:O,defaultValue:V,onValueChange:B,enableSelect:I=!0,minDate:_,maxDate:z,placeholder:M="Select range",selectPlaceholder:P="Select range",disabled:Y=!1,locale:F=y,enableClear:L=!0,children:T,className:U,enableYearNavigation:q=!1,weekStartsOn:A=0}=m,G=e(m,["value","defaultValue","onValueChange","enableSelect","minDate","maxDate","placeholder","selectPlaceholder","disabled","locale","enableClear","children","className","enableYearNavigation","weekStartsOn"]),[H,J]=S(V,O),[K,Q]=t(!1),[W,Z]=t(!1),$=a((()=>{const e=[];return _&&e.push({before:_}),z&&e.push({after:z}),e}),[_,z]),ee=a((()=>{const e=new Map;return T?r.Children.forEach(T,(r=>{var t;e.set(r.props.value,{text:null!==(t=b(r))&&void 0!==t?t:r.props.value,from:r.props.from,to:r.props.to})})):h.forEach((r=>{e.set(r.value,{text:r.text,from:r.from,to:C})})),e}),[T]),re=a((()=>{if(T)return g(T);const e=new Map;return h.forEach((r=>e.set(r.value,r.text))),e}),[T]),te=(null==H?void 0:H.selectValue)||"",ae=v(null==H?void 0:H.from,_,te,ee),oe=w(null==H?void 0:H.to,z,te,ee),de=ae||oe?x(ae,oe,F):M,le=s(null!==(D=null!==(R=null!=oe?oe:ae)&&void 0!==R?R:z)&&void 0!==D?D:C),ne=L&&!Y;return r.createElement("div",Object.assign({ref:X,className:f("w-full min-w-[10rem] relative flex justify-between text-tremor-default max-w-sm shadow-tremor-input dark:shadow-dark-tremor-input rounded-tremor-default",U)},G),r.createElement(l,{as:"div",className:f("w-full overflow-hidden",I?"rounded-l-tremor-default":"rounded-tremor-default",K&&"ring-2 ring-tremor-brand-muted dark:focus:ring-dark-tremor-brand-muted z-10")},r.createElement("div",{className:"relative w-full overflow-hidden"},r.createElement(l.Button,{onFocus:()=>Q(!0),onBlur:()=>Q(!1),disabled:Y,className:f("w-full outline-none text-left whitespace-nowrap truncate focus:ring-2 transition duration-100 rounded-l-tremor-default flex flex-nowrap","rounded-l-tremor-default border-tremor-border text-tremor-content-emphasis focus:border-tremor-brand-subtle","dark:border-dark-tremor-border dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle",I?"rounded-l-tremor-default":"rounded-tremor-default",c.lg.paddingLeft,ne?c.fourXl.paddingRight:c.twoXl.paddingRight,c.sm.paddingY,i.sm.all,p(k(ae||oe),Y))},r.createElement(o,{className:f(N("calendarIcon"),"flex-none shrink-0","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle",u.lg.height,u.lg.width,c.threeXs.negativeMarginLeft,c.sm.marginRight),"aria-hidden":"true"}),r.createElement("p",{className:"truncate"},de)),ne&&ae?r.createElement("button",{type:"button",className:f("absolute outline-none inset-y-0 right-0 flex items-center transition duration-100",c.twoXl.marginRight),onClick:e=>{e.preventDefault(),null==B||B({}),J({})}},r.createElement(d,{className:f(N("clearIcon"),"flex-none","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle",u.md.height,u.md.width)})):null),r.createElement(l.Panel,{focus:!0,className:f("absolute z-10 divide-y overflow-y-auto min-w-min left-0 outline-none rounded-tremor-default p-3","bg-tremor-background border-tremor-border divide-tremor-border shadow-tremor-dropdown","dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border dark:shadow-dark-tremor-dropdown",c.twoXs.marginTop,c.twoXs.marginBottom,i.sm.all)},r.createElement(E,Object.assign({mode:"range",showOutsideDays:!0,defaultMonth:le,selected:{from:ae,to:oe},onSelect:e=>{null==B||B({from:null==e?void 0:e.from,to:null==e?void 0:e.to}),J({from:null==e?void 0:e.from,to:null==e?void 0:e.to})},locale:F,disabled:$,enableYearNavigation:q,classNames:{day_range_middle:f("!rounded-none aria-selected:!bg-tremor-background-subtle aria-selected:dark:!bg-dark-tremor-background-subtle aria-selected:!text-tremor-content aria-selected:dark:!bg-dark-tremor-background-subtle"),day_range_start:"rounded-r-none rounded-l-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted",day_range_end:"rounded-l-none rounded-r-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted"},weekStartsOn:A},m)))),I&&r.createElement(n,{as:"div",className:f("w-48 overflow-hidden -ml-px rounded-r-tremor-default",W&&"ring-2 ring-tremor-brand-muted dark:focus:ring-dark-tremor-brand-muted z-10"),value:te,onChange:e=>{const{from:r,to:t}=ee.get(e),a=null!=t?t:C;null==B||B({from:r,to:a,selectValue:e}),J({from:r,to:a,selectValue:e})},disabled:Y},(({value:e})=>{var t;return r.createElement(r.Fragment,null,r.createElement(n.Button,{onFocus:()=>Z(!0),onBlur:()=>Z(!1),className:f("w-full outline-none text-left whitespace-nowrap truncate rounded-r-tremor-default transition duration-100","border-tremor-border shadow-tremor-input text-tremor-content-emphasis focus:border-tremor-brand-subtle","dark:border-dark-tremor-border dark:shadow-dark-tremor-input dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle",c.twoXl.paddingLeft,c.twoXl.paddingRight,c.sm.paddingY,i.sm.all,p(k(e),Y))},e&&null!==(t=re.get(e))&&void 0!==t?t:P),r.createElement(n.Options,{className:f("absolute z-10 divide-y overflow-y-auto w-full inset-x-0 right-0 outline-none","shadow-tremor-dropdown bg-tremor-background border-tremor-border divide-tremor-border rounded-tremor-default","dark:shadow-dark-tremor-dropdown dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border",c.twoXs.marginTop,c.twoXs.marginBottom,i.sm.all)},null!=T?T:h.map((e=>r.createElement(j,{key:e.value,value:e.value},e.text)))))})))}));X.displayName="DateRangePicker";export{X as default};
